<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MemberMapper">

	<sql id="criteria">
    	<trim prefix="(" suffix=") AND" prefixOverrides="OR">
        	<foreach collection="typeArr" item="type">
            	<trim prefix="OR">
                	<choose>
                    	<when test="type == 'C'.toString()">
                     		mem_company LIKE '%'||#{keyword}||'%'
                  		</when>
                  		<when test="type == 'I'.toString()">
                     		mem_id LIKE '%'||#{keyword}||'%'
                  		</when>
                  		<when test="type == 'E'.toString()">
                     		mem_email LIKE '%'||#{keyword}||'%'
                  		</when>
                  		<when test="type == 'P'.toString()">
                     		mem_phone LIKE '%'||#{keyword}||'%'
                  		</when>
               		</choose>
            	</trim>
         	</foreach>
      	</trim>
   	</sql>

	<select id="list" resultType="com.sansam.adeye.domain.MemberDTO">
		<![CDATA[
			SELECT mem_id,
				   mem_company,
				   mem_phone,
				   mem_email,
				   mem_status,
				   mem_joindate,
				   company_addr
			FROM (
				SELECT /*+ INDEX_DESC(tb_member IDX_tb_member_PK) */
					rownum rn,
					mem_id,
		     	 	mem_company,
				   	mem_phone,
				   	mem_email,
				   	mem_status,
				   	mem_joindate,
				   	company_addr
				FROM tb_member
				WHERE
		]]>
	  	<include refid="criteria"></include>         
      	<![CDATA[
      			rownum <= #{pageNum} * #{amount}
            )
         	WHERE rn > (#{pageNum} - 1) * #{amount}
      	]]>
	</select>
		
	<insert id="create">
		insert into tb_member values(#{mem_id}, #{mem_pw}, #{mem_company}, #{mem_phone}, #{mem_email}, #{mem_status},  sysdate, #{company_addr}, 'N')
	</insert>
	
	<select id="detail" resultType="com.sansam.adeye.domain.MemberDTO">
		select * from tb_member where mem_id = #{mem_id}
	</select>

  	<update id="update">
		update tb_member set mem_pw = #{mem_pw}, mem_phone = #{mem_phone}, mem_email=#{mem_email}, company_addr = #{company_addr}, mem_status = #{mem_status} where mem_id = #{mem_id}
	</update>

	<update id="delete">
		update tb_member set mem_status = 'D' where mem_id = #{mem_id}
	</update>

	<select id="login" resultType="com.sansam.adeye.domain.MemberDTO">
		SELECT * FROM tb_member WHERE mem_id = #{mem_id} AND mem_pw = #{mem_pw}
	</select>
	  
</mapper>